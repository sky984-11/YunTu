import{H as I,I as A,d as p,e as g,J,K as S,_ as q,h as l,r as u,L as O,o as z,D as V,j as d,p as w,F as j,t as G,m as M,f as B,g as Q,A as W,M as X}from"./index-D7gtUUeB.js";import{s as Z}from"./index-BBioLwpU.js";import{s as tt}from"./index-_2g678TO.js";import{s as et}from"./index-qKDsCb1Q.js";var nt={root:"p-fluid"},at=I.extend({name:"fluid",classes:nt}),ot={name:"BaseFluid",extends:A,style:at,provide:function(){return{$pcFluid:this,$parentInstance:this}}},L={name:"Fluid",extends:ot,inheritAttrs:!1};function rt(t,e,n,r,h,o){return p(),g("div",S({class:t.cx("root")},t.ptmi("root")),[J(t.$slots,"default")],16)}L.render=rt;var st={root:{position:"relative"}},it={root:"p-chart"},lt=I.extend({name:"chart",classes:it,inlineStyles:st}),ct={name:"BaseChart",extends:A,props:{type:String,data:null,options:null,plugins:null,width:{type:Number,default:300},height:{type:Number,default:150},canvasProps:{type:null,default:null}},style:lt,provide:function(){return{$pcChart:this,$parentInstance:this}}},N={name:"Chart",extends:ct,inheritAttrs:!1,emits:["select","loaded"],chart:null,watch:{data:{handler:function(){this.reinit()},deep:!0},type:function(){this.reinit()},options:function(){this.reinit()}},mounted:function(){this.initChart()},beforeUnmount:function(){this.chart&&(this.chart.destroy(),this.chart=null)},methods:{initChart:function(){var e=this;q(()=>import("./auto.esm-B7Ao7w_R.js"),[]).then(function(n){e.chart&&(e.chart.destroy(),e.chart=null),n&&n.default&&(e.chart=new n.default(e.$refs.canvas,{type:e.type,data:e.data,options:e.options,plugins:e.plugins})),e.$emit("loaded",e.chart)})},getCanvas:function(){return this.$canvas},getChart:function(){return this.chart},getBase64Image:function(){return this.chart.toBase64Image()},refresh:function(){this.chart&&this.chart.update()},reinit:function(){this.initChart()},onCanvasClick:function(e){if(this.chart){var n=this.chart.getElementsAtEventForMode(e,"nearest",{intersect:!0},!1),r=this.chart.getElementsAtEventForMode(e,"dataset",{intersect:!0},!1);n&&n[0]&&r&&this.$emit("select",{originalEvent:e,element:n[0],dataset:r})}},generateLegend:function(){if(this.chart)return this.chart.generateLegend()}}};function b(t){"@babel/helpers - typeof";return b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(t)}function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable})),n.push.apply(n,r)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?E(Object(n),!0).forEach(function(r){ut(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ut(t,e,n){return(e=dt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dt(t){var e=pt(t,"string");return b(e)=="symbol"?e:e+""}function pt(t,e){if(b(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(b(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var ht=["width","height"];function ft(t,e,n,r,h,o){return p(),g("div",S({class:t.cx("root"),style:t.sx("root")},t.ptmi("root")),[l("canvas",S({ref:"canvas",width:t.width,height:t.height,onClick:e[0]||(e[0]=function(_){return o.onCanvasClick(_)})},F(F({},t.canvasProps),t.ptm("canvas"))),null,16,ht)],16)}N.render=ft;const vt={class:"flex items-center justify-between mb-0"},mt={class:"font-semibold text-xl mb-4"},yt={class:"flex justify-center"},gt={key:1,class:"flex flex-wrap justify-center gap-3"},bt={class:"col-span-12 xl:col-span-6"},_t={class:"card flex flex-col items-center"},Pt=l("div",{class:"font-semibold text-xl mb-4"},"收入/支出",-1),Ct={class:"mt-4"},xt={class:"flex justify-between"},wt={class:"col-span-12 xl:col-span-6"},St={class:"card flex flex-col items-center"},$t=l("div",{class:"font-semibold text-xl mb-4"},"分类支出排行",-1),jt={__name:"Statistics",setup(t){const e=u(null),n=u(null),r=u(null),h=u(null),o=u({title:"月选择器",isMonthPicker:!0,MonthDate:O(new Date),dateStr:"",options:["上周","上月","近一年"]}),_=u(0),$=u(0);z(async()=>{Y(),await C(),H()});function Y(){const a=getComputedStyle(document.documentElement),s=a.getPropertyValue("--text-color"),i=a.getPropertyValue("--text-color-secondary"),c=a.getPropertyValue("--surface-border");n.value={labels:[],datasets:[{data:[],backgroundColor:[a.getPropertyValue("--p-indigo-500"),a.getPropertyValue("--p-purple-500"),a.getPropertyValue("--p-teal-500")],hoverBackgroundColor:[a.getPropertyValue("--p-indigo-400"),a.getPropertyValue("--p-purple-400"),a.getPropertyValue("--p-teal-400")]}]},h.value={plugins:{legend:{labels:{usePointStyle:!0,color:s}}}},e.value={labels:[],datasets:[{label:"收入",data:[],fill:!1,backgroundColor:a.getPropertyValue("--p-primary-500"),borderColor:a.getPropertyValue("--p-primary-500"),tension:.4,pointRadius:1},{label:"支出",data:[],fill:!1,backgroundColor:a.getPropertyValue("--p-red-500"),borderColor:a.getPropertyValue("--p-red-500"),tension:.4,pointRadius:1}]},r.value={plugins:{legend:{labels:{fontColor:s}}},scales:{x:{ticks:{color:i},grid:{color:c,drawBorder:!1}},y:{ticks:{color:i},grid:{color:c,drawBorder:!1}}}}}function T(){o.value.isMonthPicker=!o.value.isMonthPicker,o.value.title=o.value.isMonthPicker?"月选择器":"自定义"}function U(a){o.value.MonthDate=O(a),C()}function K(a){o.value.dateStr=a,C()}const R=(a,s,i)=>{e.value.labels=a,e.value.datasets[0].data=s,e.value.datasets[1].data=i},k=(a,s)=>{n.value.labels=a,n.value.datasets[0].data=s},C=async()=>{const a=o.value.isMonthPicker?"month":"year",s=o.value.isMonthPicker?o.value.MonthDate:o.value.dateStr;try{const{dates:i,income:c,expenses:P}=await V.getMonthlyIncomeAndExpenses(a,s);R(i,c,P),_.value=c.reduce((f,m)=>f+m,0),$.value=P.reduce((f,m)=>f+m,0);const{labels:x,data:v}=await V.getExpensesByCategory(a,s);v.length!==0?k(x,v):k(["暂无数据"],[1])}catch(i){console.error("Error fetching data:",i)}};function H(){const a=new Date().getFullYear(),s=a-4;for(let i=s;i<=a;i++)o.value.options.push(String(i))}return(a,s)=>{const i=W,c=et,P=tt,x=Z,v=N,f=X,m=L;return p(),g(j,null,[d(x,null,{title:w(()=>[l("div",vt,[l("div",mt,G(o.value.title),1),d(i,{icon:"pi pi-arrow-right-arrow-left",class:"p-button-text",onClick:T})])]),content:w(()=>[l("div",yt,[o.value.isMonthPicker?(p(),M(c,{key:0,"onUpdate:modelValue":[U,s[0]||(s[0]=y=>o.value.MonthDate=y)],modelValue:o.value.MonthDate,view:"month",dateFormat:"mm/yy"},null,8,["modelValue"])):B("",!0),o.value.isMonthPicker?B("",!0):(p(),g("div",gt,[(p(!0),g(j,null,Q(o.value.options,y=>(p(),M(P,{key:y,onClick:D=>K(y),modelValue:o.value.dateStr,"onUpdate:modelValue":s[1]||(s[1]=D=>o.value.dateStr=D),options:[y]},null,8,["onClick","modelValue","options"]))),128))]))])]),_:1}),d(m,{style:{"margin-top":"10px"},class:"grid grid-cols-12 gap-8"},{default:w(()=>[l("div",bt,[l("div",_t,[Pt,d(v,{type:"line",data:e.value,options:r.value},null,8,["data","options"]),l("div",Ct,[l("div",xt,[d(f,{severity:"success",value:"收入:"+_.value.toFixed(2)+"元"},null,8,["value"]),d(f,{severity:"danger",value:"支出:"+$.value.toFixed(2)+"元"},null,8,["value"])])])])]),l("div",wt,[l("div",St,[$t,d(v,{type:"doughnut",data:n.value,options:h.value},null,8,["data","options"])])])]),_:1})],64)}}};export{jt as default};
