import{s as M}from"./index-BBioLwpU.js";import{k as O,a as T,r as i,o as q,D as u,l as J,B as x,c as G,d as o,m as f,p as w,f as l,h as t,n as k,j as h,t as d,e as n,g as H,F as R,q as K,C as P,s as Q,v as W,x as X,y as Y,z as Z,A as ee}from"./index-D7gtUUeB.js";const ae={class:"flex flex-col items-center mb-6"},te={class:"mt-2"},se={key:0},oe={class:"text-surface-900 dark:text-surface-0 font-medium mr-2 mb-1 md:mb-0"},re={class:"flex items-center justify-center text-muted-color"},le={class:"flex justify-between mb-4"},ne=t("div",null,[t("span",{class:"text-surface-900 dark:text-surface-0 font-medium mr-2 mb-1 md:mb-0"},"备注")],-1),ce={class:"flex items-center justify-center text-muted-color"},ie={key:0,class:"flex items-center"},ue={class:"block w-20 overflow-hidden text-ellipsis whitespace-nowrap mr-1"},de={class:"card flex flex-col items-center gap-6"},me={class:"flex justify-between"},fe={__name:"Details",setup(ve){const D=O(),U=T(),e=i(null),c=i(!1),m=i(!1),v=i(null),B=i([]);q(()=>{A()});async function A(){const s=D.params.records_id;try{const a=await u.list("transactions",`records_id = ${s}`,"account_categories","transactions.category_id = account_categories.category_id");e.value=a[0],B.value=[{label:"支付时间",value:a[0].created_at},{label:"收款方",value:a[0].payee},{label:"收款方全称",value:a[0].recipient},{label:"来源",value:a[0].source},{label:"支付方式",value:a[0].payment_method},{label:"乘车时间",value:a[0].ride_time}],e.value.image&&(v.value=await E(e.value.image))}catch(a){console.error("Error parsing image:",a)}}function C(){console.log(e.value),c.value=!0}function L(){m.value=!0}function V(){c.value=!1,u.edit("transactions",{amount:e.value.amount},`records_id = ${e.value.records_id}`)}function j(){m.value=!1,u.edit("transactions",{remark:e.value.remark},`records_id = ${e.value.records_id}`)}function F(){const s=D.params.records_id;u.del("transactions",`records_id = ${s}`),U.push({name:"dashboard"})}function I(s){return s.slice((s.lastIndexOf(".")-1>>>0)+2)}async function S(s){const a=s.files[0],p=new FileReader;e.value.image&&await K(e.value.image,{baseDir:x.AppLocalData});const _=`images/${P.MD5(a).toString()}.${I(a.name)}`,y=await a.arrayBuffer(),g=new Uint8Array(y);await Q(_,g,{baseDir:x.AppLocalData}),await u.edit("transactions",{image:_},`records_id = ${e.value.records_id}`),p.onload=b=>{v.value=b.target.result,console.log(e.value.image)},p.readAsDataURL(a)}async function E(s){const a=await J(s,{baseDir:x.AppLocalData});return z(a)}function z(s){const a=new Blob([s],{type:"image/png"});return URL.createObjectURL(a)}return(s,a)=>{const p=G("font-awesome-icon"),$=W,_=X,y=Y,g=Z,b=ee,N=M;return e.value?(o(),f(N,{key:0},{header:w(()=>[t("div",ae,[t("div",{class:k(["flex items-center justify-center w-12 h-12 rounded-full",e.value.bg_color]),style:{width:"2.5rem",height:"2.5rem"}},[h(p,{icon:["fas",e.value.icon],class:k(e.value.color+" !text-xl")},null,8,["icon","class"])],2),t("h2",te,d(e.value.name),1)]),t("div",{class:k(["text-center text-3xl font-semibold mb-4",{"text-red-500":e.value.type=="true","text-green-500":e.value.type=="false"}])},[c.value?l("",!0):(o(),n("span",se,d(e.value.amount),1)),c.value?(o(),f($,{key:1,modelValue:e.value.amount,"onUpdate:modelValue":a[0]||(a[0]=r=>e.value.amount=r),inputId:"currency-us",mode:"currency",currency:"USD",locale:"en-US",onBlur:V},null,8,["modelValue"])):l("",!0),c.value?l("",!0):(o(),n("i",{key:2,class:"pi pi-pencil text-gray-400 ml-1 cursor-pointer",onClick:C}))],2)]),content:w(()=>[(o(!0),n(R,null,H(B.value,r=>(o(),n("div",{class:"flex justify-between mb-4",key:r.label},[r.value?(o(),n(R,{key:0},[t("div",null,[t("span",oe,d(r.label),1)]),t("div",re,d(r.value),1)],64)):l("",!0)]))),128)),t("div",le,[ne,t("div",ce,[m.value?l("",!0):(o(),n("div",ie,[t("span",ue,d(e.value.remark),1),t("i",{class:"pi pi-pencil text-gray-400 cursor-pointer",onClick:L})])),m.value?(o(),f(_,{key:1,class:"text-left",onBlur:a[1]||(a[1]=r=>j(e.value.remark)),modelValue:e.value.remark,"onUpdate:modelValue":a[2]||(a[2]=r=>e.value.remark=r),autoResize:"",rows:"2",cols:"20"},null,8,["modelValue"])):l("",!0)])]),t("div",de,[h(y,{mode:"basic",onSelect:S,customUpload:"",auto:"",severity:"secondary",class:"p-button-outlined",chooseLabel:"上传",chooseIcon:"pi pi-camera"}),v.value?(o(),f(g,{key:0,src:v.value,alt:"Image",class:"shadow-md rounded-xl w-full sm:w-64",style:{filter:"grayscale(100%)"},preview:""},null,8,["src"])):l("",!0)])]),footer:w(()=>[t("div",me,[h(b,{label:"删除",class:"w-full",severity:"danger",onClick:F})])]),_:1})):l("",!0)}}};export{fe as default};
